/*------------------------
alter view view_poline
as
select PC01001,PC03002,SC01001,SC01002,SC01003,PL01001,PL01002,convert(numeric(15,3),PC03010) as PC03010,
RTRIM(CHAPUR.SCUN003) UNITPUR,CASE SC01140 WHEN 0 THEN convert(numeric(15,3),PC03011) ELSE convert(numeric(15,3),PC03011*SC01140) END AS PC03011,
case WHEN SC01140=0 THEN convert(numeric(15,3),(PC03010-PC03011)) ELSE convert(numeric(15,3),(PC03010-PC03011)*SC01140) end AS DH,
RTRIM(CHASTC.SCUN003) UNIT,PC03035,'32' Company,SC01069 UQTY from PC033200 INNER JOIN PC013200 ON PC03001=PC01001
left JOIN PL013200 ON PC01003=PL01001
left JOIN SC013200 ON SC01001=PC03005
left JOIN SCUN3200 CHASTC ON CHASTC.SCUN001=SC01133 AND CHASTC.SCUN002='ENG'
left JOIN SCUN3200 CHAPUR ON CHAPUR.SCUN001=SC01134 AND CHAPUR.SCUN002='ENG'
union all
select PC01001,PC03002,SC01001,SC01002,SC01003,PL01001,PL01002,convert(numeric(15,3),PC03010) as PC03010,
RTRIM(CHAPUR.SCUN003) UNITPUR,CASE SC01140 WHEN 0 THEN convert(numeric(15,3),PC03011) ELSE convert(numeric(15,3),PC03011*SC01140) END AS PC03011,
case WHEN SC01140=0 THEN convert(numeric(15,3),(PC03010-PC03011)) ELSE convert(numeric(15,3),(PC03010-PC03011)*SC01140) end AS DH,
RTRIM(CHASTC.SCUN003) UNIT,PC03035,'31' Company,SC01069 UQTY from PC033100 INNER JOIN PC013100 ON PC03001=PC01001
left JOIN PL013100 ON PC01003=PL01001
left JOIN SC013100 ON SC01001=PC03005
left JOIN SCUN3100 CHASTC ON CHASTC.SCUN001=SC01133 AND CHASTC.SCUN002='ENG'
left JOIN SCUN3100 CHAPUR ON CHAPUR.SCUN001=SC01134 AND CHAPUR.SCUN002='ENG'
-------------------------------*/

ALTER view view_poline
as
select PC01001,PC03002,SC01001,SC01002,SC01003,PL01001,PL01002,PC03010/(CASE SC01072 WHEN 0 THEN 1 ELSE SC01072 END) PC03010,PC03011/(CASE SC01072 WHEN 0 THEN 1 ELSE SC01072 END) PC03011,SC01035,
RTRIM(CHAPUR.SCUN003) UNITPUR,RTRIM(CHASTC.SCUN003) UNITSTC,CASE SC01072 WHEN 0 THEN 1 ELSE SC01072 END AS SC01072,CASE SC01073 WHEN 0 THEN 1 ELSE SC01073 END AS SC01073,
(PC03010-PC03011)/(CASE SC01072 WHEN 0 THEN 1 ELSE SC01072 END) AS DH,
PC03035,'32' Company,1.0 UQTY from PC033200 INNER JOIN PC013200 ON PC03001=PC01001
left JOIN PL013200 ON PC01003=PL01001
left JOIN SC013200 ON SC01001=PC03005
left JOIN SCUN3200 CHASTC ON CHASTC.SCUN001=SC01133 AND CHASTC.SCUN002='ENG'
left JOIN SCUN3200 CHAPUR ON CHAPUR.SCUN001=SC01134 AND CHAPUR.SCUN002='ENG'
union all
select PC01001,PC03002,SC01001,SC01002,SC01003,PL01001,PL01002,PC03010/(CASE SC01072 WHEN 0 THEN 1 ELSE SC01072 END) PC03010,PC03011/(CASE SC01072 WHEN 0 THEN 1 ELSE SC01072 END) PC03011,SC01035,
RTRIM(CHAPUR.SCUN003) UNITPUR,RTRIM(CHASTC.SCUN003) UNITSTC,CASE SC01072 WHEN 0 THEN 1 ELSE SC01072 END AS SC01072,CASE SC01073 WHEN 0 THEN 1 ELSE SC01073 END AS SC01073,
(PC03010-PC03011)/(CASE SC01072 WHEN 0 THEN 1 ELSE SC01072 END) AS DH,
PC03035,'32' Company,1.0 UQTY from PC033100 INNER JOIN PC013100 ON PC03001=PC01001
left JOIN PL013100 ON PC01003=PL01001
left JOIN SC013100 ON SC01001=PC03005
left JOIN SCUN3100 CHASTC ON CHASTC.SCUN001=SC01133 AND CHASTC.SCUN002='ENG'
left JOIN SCUN3100 CHAPUR ON CHAPUR.SCUN001=PC03009 AND CHAPUR.SCUN002='ENG'

select * from view_WOLine_NOGROUP where MP65001='3141003007'

select * from view_poline
select * from SCUN3200
select * from PC013200

alter view view_warehouse
as
select SC36001,SC36002,SC36003,'32' Company from SC363200
union all
select SC36001,SC36002,SC36003,'31' Company from SC363100

alter view [dbo].[view_WOLine]
as
SELECT RTRIM(MP65004) StockCode,SUM(MP65022) PlanQty,RTRIM(CHA.SCUN003) Unit,SC01002+'-'+SC01003 StockName,MAX(MP65003) as MP65003,MP65002,MP65042,MP65001,'32' Company FROM MP653200 
INNER JOIN SCUN3200 CHA ON CHA.SCUN001=MP65036 AND CHA.SCUN002='CHA' 
left join SC013200 sc on MP65004=sc.SC01001
group by MP65004,SCUN003,SC01002,SC01003,MP65001,MP65042,MP65002
union all
SELECT RTRIM(MP65004) StockCode,SUM(MP65022) PlanQty,RTRIM(CHA.SCUN003) Unit,SC01002+'-'+SC01003 StockName,MAX(MP65003) as MP65003,MP65002,MP65042,MP65001,'31' Company FROM MP653100 
INNER JOIN SCUN3100 CHA ON CHA.SCUN001=MP65036 AND CHA.SCUN002='CHA' 
left join SC013100 sc on MP65004=sc.SC01001 
group by MP65004,SCUN003,SC01002,SC01003,MP65001,MP65042,MP65002

alter view view_WOLine_NOGROUP
as
SELECT RTRIM(MP65004) StockCode,SUM(MP65022) PlanQty,MP65011,RTRIM(ENG.SCUN003) Unit,SC01002+'-'+SC01003 StockName,MP65003,MP65002,MP65042,MP65001,'32' Company FROM MP653200 
INNER JOIN SCUN3200 ENG ON ENG.SCUN001=MP65036 AND ENG.SCUN002='ENG' 
left join SC013200 sc on MP65004=sc.SC01001
group by MP65004,MP65007,SCUN003,SC01002,SC01003,MP65003,MP65001,MP65042,MP65002,MP65011
union all
SELECT RTRIM(MP65004) StockCode,SUM(MP65022) PlanQty,MP65011,RTRIM(ENG.SCUN003) Unit,SC01002+'-'+SC01003 StockName,MP65003,MP65002,MP65042,MP65001,'31' Company FROM MP653100 
INNER JOIN SCUN3100 ENG ON ENG.SCUN001=MP65036 AND ENG.SCUN002='ENG' 
left join SC013100 sc on MP65004=sc.SC01001 
group by MP65004,MP65007,SCUN003,SC01002,SC01003,MP65003,MP65001,MP65042,MP65002,MP65011

select * from view_WOLine where MP65001='3101001322'

select

alter view view_WO
as
select MP64001,MP64002,SC01002,SC01003,SC01073,MP64003,MP64004,SC01035,MP64005,RTRIM(SCUN003) UNIT,MP64122,'32' Company from MP643200
inner join SC013200 ON SC01001=MP64002 
INNER JOIN SCUN3200 ENG ON ENG.SCUN001=SC01133 AND ENG.SCUN002='ENG'
union all
select MP64001,MP64002,SC01002,SC01003,SC01073,MP64003,MP64004,SC01035,MP64005,RTRIM(SCUN003) UNIT,MP64122,'31' Company from MP643100
inner join SC013100 ON SC01001=MP64002 
INNER JOIN SCUN3100 ENG ON ENG.SCUN001=SC01133 AND ENG.SCUN002='ENG'



alter view view_Stock
as
select SC01001,SC01002,SC01003,RTRIM(SCUN003) UNIT,'32' Company,SC01035,1.0 UQTY,SC01072,SC01073 from SC013200
INNER JOIN SCUN3200 ENG ON SCUN001=SC01133 AND SCUN002='ENG'
union all
select SC01001,SC01002,SC01003,RTRIM(SCUN003) UNIT,'31' Company,SC01035,1.0 UQTY,SC01072,SC01073 from SC013100
INNER JOIN SCUN3100 ENG ON SCUN001=SC01133 AND SCUN002='ENG'

alter view view_Workcenter
as
select MP50001,MP50002,'32' Company from MP503200
union all
select MP50001,MP50002,'31' Company from MP503100

alter view view_SOLine
as
select OR01001,OR01003,SL01002,OR03002,OR03005,OR03006,OR03007,OR03008,SC01035,OR03046,OR03011,RTRIM(SCUN003) UNIT,OR01015,'32' Company from OR013200
LEFT join SL013200 ON SL01001=OR01003
LEFT join OR033200 on OR03001=OR01001
left join SC013200 on SC01001=OR03005
LEFT join SCUN3200 ENG ON SCUN001=OR03010 AND SCUN002='ENG'
where OR03046 not like 'CW%'
union all
select OR01001,OR01003,SL01002,OR03002,OR03005,OR03006,OR03007,OR03008,SC01035,OR03046,OR03011,RTRIM(SCUN003) UNIT,OR01015,'31' Company from OR013100
LEFT join SL013100 ON SL01001=OR01003
LEFT join OR033100 on OR03001=OR01001
left join SC013100 on SC01001=OR03005
LEFT join SCUN3100 ENG ON SCUN001=OR03010 AND SCUN002='ENG'
where OR03046 not like 'CW%'


create view view_SODeliveryLine
as
SELECT OR19001,OR01003,SL01002,OR19002,OR03005,OR03006,OR03007,OR19007,OR19030,OR19005,SC33022,OR19012,SC01035,OR03046,OR03011,RTRIM(SCUN003) UNIT,OR01015,'31' Company
FROM OR193100
left join OR013100 ON OR01001=OR19001
LEFT JOIN OR033100 ON OR19001=OR03001 AND OR19002=OR03002
LEFT JOIN SC333100 ON OR03005=SC33001 AND OR03046=SC33002 AND OR19005=SC33003
LEFT join SL013100 ON SL01001=OR01003
left join SC013100 on SC01001=OR03005
LEFT join SCUN3100 ENG ON SCUN001=OR03010 AND SCUN002='ENG'
where OR03046 like 'CW%'
union all
SELECT OR23001,OR20003,SL01002,OR23002,OR21005,OR21006,OR21007,OR23007,OR23030,OR23005,SC33022,OR23012,SC01035,OR21046,OR21011,RTRIM(SCUN003) UNIT,OR20015,'31' Company
FROM OR233100
left join OR203100 ON OR20001=OR23001
LEFT JOIN OR213100 ON OR23001=OR21001 AND OR23002=OR21002
LEFT JOIN SC333100 ON OR21005=SC33001 AND OR21046=SC33002 AND OR23005=SC33003
LEFT join SL013100 ON SL01001=OR20003
left join SC013100 on SC01001=OR21005
LEFT join SCUN3100 ENG ON SCUN001=OR21010 AND SCUN002='ENG'
where OR21046 like 'CW%'
union all
SELECT OR19001,OR01003,SL01002,OR19002,OR03005,OR03006,OR03007,OR19007,OR19030,OR19005,SC33022,OR19012,SC01035,OR03046,OR03011,RTRIM(SCUN003) UNIT,OR01015,'32' Company
FROM OR193200
left join OR013200 ON OR01001=OR19001
LEFT JOIN OR033200 ON OR19001=OR03001 AND OR19002=OR03002
LEFT JOIN SC333200 ON OR03005=SC33001 AND OR03046=SC33002 AND OR19005=SC33003
LEFT join SL013200 ON SL01001=OR01003
left join SC013200 on SC01001=OR03005
LEFT join SCUN3200 ENG ON SCUN001=OR03010 AND SCUN002='ENG'
where OR03046 like 'CW%'
union all
SELECT OR23001,OR20003,SL01002,OR23002,OR21005,OR21006,OR21007,OR23007,OR23030,OR23005,SC33022,OR23012,SC01035,OR21046,OR21011,RTRIM(SCUN003) UNIT,OR20015,'32' Company
FROM OR233200
left join OR203200 ON OR20001=OR23001
LEFT JOIN OR213200 ON OR23001=OR21001 AND OR23002=OR21002
LEFT JOIN SC333200 ON OR21005=SC33001 AND OR21046=SC33002 AND OR23005=SC33003
LEFT join SL013200 ON SL01001=OR20003
left join SC013200 on SC01001=OR21005
LEFT join SCUN3200 ENG ON SCUN001=OR21010 AND SCUN002='ENG'
where OR21046 like 'CW%'

select * from view_SODeliveryLine


SELECT TOP 20 OR19001,OR19002,OR03005,OR03006,OR19007,OR19030,OR19005,SC33022,OR19012
FROM OR193100 o
LEFT JOIN OR033100 WITH(Nolock) ON OR19001=OR03001 AND OR19002=OR03002
LEFT JOIN SC333100 WITH(Nolock) ON OR03005=SC33001 AND OR03046=sc33002 AND OR19005=SC33003

union all

SELECT TOP 20 OR23001,OR23002,OR21005,OR21006,OR23007,OR23030,OR23005,sc33022,OR23012
FROM OR233100 o
LEFT JOIN OR213100 WITH(Nolock) ON OR23001=OR21001 AND OR23002=OR21002 AND OR23034=OR21065
LEFT JOIN SC333100 WITH(Nolock) ON OR21005=SC33001 AND OR21046=sc33002 AND OR23005=SC33003

select * from view_SOLine
select * from OR033200

select * from OR013200

select * from view_POLine

insert into BarcodeQP.dbo.WK02(WK02002,WK02003,WK02004,WK02005,WK02009,WK02011)
select MP65001,StockCode,StockName,convert(numeric(15,2),PlanQty*9970.000000),convert(numeric(15,2),PlanQty*9970.000000),1 from view_WOLine where MP65001='3091000237' Order by MP65001,MP65003
select *,convert(numeric(15,2),PlanQty*9970.000000) from view_WOLine where MP65001='3091000237' Order by MP65001,MP65003
select * from view_WO where MP64001='3091000237'

select * from WK02
select * from MP643200

select * from SY243200


select row_number() over a,* from view_WOLine order by MP65001,MP65003



select * from view_SOLine where OR03005='C10269'

select * from view_SODeliveryLine where OR19001='1141100016'
1141100013

select * from WK05

select OR01001,OR0100


select OR01001,OR01003,SL01002,OR03002,OR03005,OR03006,OR03007,OR03008,OR03011,RTRIM(SCUN003) UNIT,OR01015,'32' Company from OR013200
LEFT join SL013200 ON SL01001=OR01003
LEFT join OR033200 on OR03001=OR01001
LEFT join SCUN3200 ENG ON SCUN001=OR03010 AND SCUN002='ENG'
where OR01001='1141100013'
union all



select OR01001,OR01003,SL01002,OR03002,OR03005,OR03006,OR03007,OR03011,RTRIM(SCUN003) UNIT,OR01015,'31' Company from OR013100
LEFT join SL013100 ON SL01001=OR01003
LEFT join OR033100 on OR03001=OR01001
LEFT join SCUN3100 ENG ON SCUN001=OR03010 AND SCUN002='ENG'
where OR01001='1141100015'


SELECT * FROM OR013100 WHERE OR01001='1141100015'
SELECT * FROM OR033100 WHERE OR03001='1141100015'
SELECT * FROM OR193100 WHERE OR19001='1141100015'
SELECT * FROM OR203100 WHERE OR20001='1141100015'
SELECT * FROM OR213100 WHERE OR21001='1141100015'
SELECT * FROM OR233100 WHERE OR23001='1141100015'

SELECT OR23001,OR23002,OR23004,OR23011,OR21005,OR21006,OR23005,OR23007,OR23030 
FROM OR233100 LEFT JOIN OR213100 ON OR21001=OR23001 AND OR21002=OR23002 AND OR21065=OR23034 
WHERE OR23001='1141100015' 
UNION
SELECT OR19001,OR19002,OR19004,OR19011,OR03005,OR03006,OR19005,OR19007,OR19030 
FROM OR193100 LEFT JOIN OR033100 ON OR03001=OR19001 AND OR03002=OR19002 
WHERE OR19001='1141100015' 





select * from SC333100 WHERE SC33005>0




declare @result varchar(20)
set @result=N'YES'
select @result=count(distinct(substring(WK05002,4,1))) from WK05 --where WK05001 IN ([BIDS])
select @result
if @RC>0
begin
	set @result=N'请对同一批工单进行ISSUE'
end
select distinct(substring(WK05002,4,1)) from WK05 where WK05001 IN ([BIDS])
set @RC=0 
select @RC=count(WK05001) from WK05 where substring(WK05002,4,1)<@number
if @RC>0
begin
	set @result=N'请先将之前的工单ISSUE'
end
set @RC=0 
select count(distinct(RW01034)) from WK05 inner join RW01 ON RW01001=WK05004 where WK05001 IN ([BIDS])
if @RC>1


